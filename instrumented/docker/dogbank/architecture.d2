direction: down

title: |md
  # ðŸ¦ DogBank - Arquitetura de MicroserviÃ§os
  **Com HTTPS, Autorizador e Ledger**
|

clients: {
  label: "ðŸŒ CLIENTS"
  style: {
    fill: "#2d3436"
    stroke: "#00d9ff"
  }
  
  web: "ðŸ–¥ï¸ Web App\n(React)"
  mobile: "ðŸ“± Mobile App"
  api: "ðŸ”Œ API Client"
}

gateway: {
  label: "ðŸ”’ API GATEWAY (Nginx)"
  style: {
    fill: "#0984e3"
    stroke: "#00d9ff"
  }
  
  http: "HTTP :80\nâ†“ Redirect 301"
  https: "HTTPS :443\nTLS 1.3 | HTTP/2"
  
  security: {
    label: "ðŸ›¡ï¸ Security Layer"
    style: {
      fill: "#e17055"
    }
    rate: "â±ï¸ Rate Limiting\nLogin: 5/min\nTransactions: 30/min"
    headers: "ðŸ“‹ Security Headers\nHSTS | CSP | X-Frame"
    cors: "ðŸ”— CORS\nOrigin Validation"
  }
  
  ssl: "ðŸ” SSL Certificates"
}

services: {
  label: "âš™ï¸ MICROSERVICES"
  style: {
    fill: "#1a1a2e"
    stroke: "#00d9ff"
  }
  
  auth: {
    label: "ðŸ”‘ Auth Service :8088"
    style: {
      fill: "#6c5ce7"
    }
    desc: |md
      â€¢ Login/Logout
      â€¢ User Management
      â€¢ Password Validation
    |
  }
  
  account: {
    label: "ðŸ’³ Account Service :8089"
    style: {
      fill: "#6c5ce7"
    }
    desc: |md
      â€¢ Account CRUD
      â€¢ Balance Management
      â€¢ User Accounts
    |
  }
  
  transaction: {
    label: "ðŸ’¸ Transaction Service :8084"
    style: {
      fill: "#6c5ce7"
    }
    desc: |md
      â€¢ PIX Transfers
      â€¢ Transaction History
      â€¢ âš ï¸ SQL Injection Demo
    |
  }
  
  autorizador: {
    label: "âœ… Autorizador Service :8090"
    style: {
      fill: "#00b894"
      stroke: "#00d9ff"
      stroke-width: 3
    }
    desc: |md
      ðŸ†• **NEW MODULE**
      â€¢ Transaction Authorization
      â€¢ Fraud Detection
      â€¢ Limit Validation
    |
  }
  
  ledger: {
    label: "ðŸ“’ Ledger Service :8091"
    style: {
      fill: "#00b894"
      stroke: "#00d9ff"
      stroke-width: 3
    }
    desc: |md
      ðŸ†• **NEW MODULE**
      â€¢ Double-Entry Bookkeeping
      â€¢ Account Balances
      â€¢ Audit Trail
    |
  }
  
  bancocentral: {
    label: "ðŸ›ï¸ Banco Central :8085"
    style: {
      fill: "#6c5ce7"
    }
    desc: |md
      â€¢ PIX Validation
      â€¢ Central Bank API
      â€¢ Compliance
    |
  }
  
  integration: {
    label: "ðŸ”— Integration :8082"
    style: {
      fill: "#6c5ce7"
    }
    desc: |md
      â€¢ Datadog Metrics
      â€¢ External APIs
      â€¢ Monitoring
    |
  }
  
  notification: {
    label: "ðŸ“¢ Notification :8083"
    style: {
      fill: "#6c5ce7"
    }
    desc: |md
      â€¢ Email/SMS
      â€¢ Push Notifications
      â€¢ Alerts
    |
  }
}

data: {
  label: "ðŸ’¾ DATA LAYER"
  style: {
    fill: "#d63031"
    stroke: "#00d9ff"
  }
  
  postgres: {
    shape: cylinder
    label: "ðŸ˜ PostgreSQL :5432"
    desc: |md
      â€¢ usuarios
      â€¢ contas
      â€¢ transacoes_pix
      â€¢ ledger_entries
    |
  }
  
  redis: {
    shape: cylinder
    label: "âš¡ Redis :6379"
    desc: |md
      â€¢ Session Cache
      â€¢ Rate Limit State
    |
  }
}

observability: {
  label: "ðŸ“Š OBSERVABILITY"
  style: {
    fill: "#fdcb6e"
  }
  
  datadog: "ðŸ• Datadog\nAPM | Logs | Metrics | ASM"
  logs: "ðŸ“ Nginx Logs"
}

# Client connections
clients.web -> gateway.https: HTTPS
clients.mobile -> gateway.https: HTTPS
clients.api -> gateway.https: HTTPS
gateway.http -> gateway.https: 301 Redirect {style.stroke-dash: 5}

# Gateway to security
gateway.https -> gateway.security
gateway.https -> gateway.ssl

# Gateway to services
gateway.security -> services.auth: /api/auth/*
gateway.security -> services.account: /api/accounts/*
gateway.security -> services.transaction: /api/transactions/*
gateway.security -> services.autorizador: /api/autorizador/*
gateway.security -> services.ledger: /api/ledger/*
gateway.security -> services.bancocentral: /api/bancocentral/*
gateway.security -> services.integration: /api/integration/*
gateway.security -> services.notification: /api/notifications/*

# Service to database
services.auth -> data.postgres
services.account -> data.postgres
services.transaction -> data.postgres
services.autorizador -> data.postgres
services.ledger -> data.postgres
services.bancocentral -> data.postgres
services.notification -> data.postgres

# Inter-service communication
services.transaction -> services.bancocentral: Validate PIX
services.transaction -> services.autorizador: Authorize
services.transaction -> services.ledger: Record Entry
services.transaction -> services.account: Update Balance
services.transaction -> services.notification: Send Alert

services.autorizador -> services.account: Check Limits
services.ledger -> services.account: Balance Update

# Cache
services.auth -> data.redis: Session {style.stroke-dash: 5}
services.autorizador -> data.redis: Rate State {style.stroke-dash: 5}

# Observability
services.integration -> observability.datadog
gateway.https -> observability.logs {style.stroke-dash: 5}
